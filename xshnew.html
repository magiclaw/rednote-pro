<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#FF2442">
    <title>RedNote Pro - ç»†èŠ‚è´¨æ„Ÿç²¾ä¿®ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@300;500;700;900&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
        :root {
            --primary: #FF2442;
            --sidebar-w: 380px;
            --card-w: 450px;
            --card-h: 600px;
            
            /* åŠ¨æ€å˜é‡ */
            --user-font: 'Noto Serif SC', serif;
            --cover-scale: 1.0;
            --content-scale: 1.0;
            --body-size: 16px;
            --strong-color: #FF2442;
            --content-head-color: #000000;
            --content-text-color: #000000;
            --card-radius: 12px;
            
            /* å°é¢å›¾ç‰‡å˜é‡ */
            --img-aspect: auto; 
            --img-fit: cover;
            --portrait-bg: none;
            
            /* å°é¢æ’ç‰ˆ */
            --cover-align-items: center;
            --cover-text-align: center;
            
            /* å°é¢æ ‡é¢˜é¢œè‰² */
            --title-color: #000000;
            --title-gradient: none;
            --title-clip: border-box;
            --title-text-fill: currentColor;

            /* é£æ ¼èƒŒæ™¯ */
            --bg-fresh: linear-gradient(180deg, #A8E0D7 0%, #81B3E8 100%);
            /* ğŸ”´ [ä¿®æ”¹] å›½æ½®èƒŒæ™¯ï¼šè°ƒæµ…é¢œè‰²ï¼Œæ›´æŸ”å’Œ */
            --bg-chinese: linear-gradient(135deg, #F7E9D7 0%, #E6CBA8 50%, #D4B483 100%); 
            --bg-journal: #fffef8;
            --bg-novel: #F5F1E5;
            --bg-matcha: #e8f5e9;
            
            /* ğŸ”´ [ä¿®æ”¹] æµªæ¼«èƒŒæ™¯ï¼šä¸­ç­‰é¥±å’Œåº¦ï¼Œä»‹äºå¤ªæµ…å’Œå¤ªæ·±ä¹‹é—´ */
            --bg-romantic: linear-gradient(180deg, #E8D4FD 0%, #BBE2FC 100%);
        }
        
        * { box-sizing: border-box; outline: none; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
            background-color: #EEF1F5;
            margin: 0; display: flex; height: 100vh; color: #333; overflow: hidden;
        }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
                overflow: auto;
            }
            
            .sidebar {
                width: 100% !important;
                height: auto;
                border-right: none;
                border-bottom: 1px solid #e6e8eb;
            }
            
            .content {
                flex: 1;
                width: 100% !important;
            }
            
            .card-wrapper {
                transform: scale(0.8) !important;
                margin: -40px 0 !important;
            }
            
            .control-group {
                margin-bottom: 16px !important;
            }
            
            .control-row {
                flex-direction: column;
                gap: 8px !important;
            }
        }
        
        @media (max-width: 480px) {
            .card-wrapper {
                transform: scale(0.6) !important;
                margin: -80px 0 !important;
            }
        }

        /* å·¦ä¾§æ§åˆ¶å° */
        .sidebar { 
            width: var(--sidebar-w); 
            background: #fff; 
            border-right: 1px solid #EEE; 
            display: flex; 
            flex-direction: column; 
            flex-shrink: 0; 
            z-index: 10;
            box-shadow: 4px 0 20px rgba(0,0,0,0.02);
            position: relative;
        }
        
        /* ä¾§è¾¹æ ç¼©æ”¾æŠŠæ‰‹ */
        .sidebar-resizer {
            position: absolute;
            top: 0;
            right: -4px;
            width: 8px;
            height: 100%;
            cursor: col-resize;
            z-index: 20;
            transition: background 0.2s;
        }
        .sidebar-resizer:hover, .sidebar-resizer.resizing {
            background: rgba(255, 36, 66, 0.2);
        }

        .sidebar-header { 
            padding: 24px 20px; 
            border-bottom: 1px solid #EEE; 
            font-weight: 800; 
            font-size: 20px; 
            display: flex;
            justify-content: center;
            align-items: center;
            letter-spacing: -0.5px;
        }
        .sidebar-header .logo { color: #1A1A1A; }
        .sidebar-header .logo span { color: var(--primary); }
        
        .contact-btn-wrap {
            padding: 0 20px 20px;
        }
        .contact-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px;
            border-radius: 14px;
            font-size: 14px;
            font-weight: 700;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            box-shadow: 0 4px 15px rgba(118, 75, 162, 0.3);
        }
        .contact-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(118, 75, 162, 0.4);
            filter: brightness(1.1);
        }
        .contact-btn i { font-size: 18px; }

        .sidebar-content { flex: 1; overflow-y: auto; padding: 24px 20px; display: flex; flex-direction: column; gap: 28px; }
        .group-title { 
            font-size: 13px; 
            font-weight: 700; 
            color: #A0A0A0; 
            padding-bottom: 12px; 
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .group-title i { font-size: 16px; color: #CCC; }

        /* é£æ ¼ç½‘æ ¼ */
        .style-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .style-btn {
            padding: 10px; border: 1px solid transparent; border-radius: 12px; cursor: pointer;
            font-size: 12px; font-weight: 600; color: #555;
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px;
            transition: 0.2s; height: 60px;
        }
        
        .btn-aurora { background: linear-gradient(135deg, #EADDFF 0%, #F8BBD0 100%); color: #6200EE; }
        .btn-fresh  { background: #A8E0D7; color: #0097A7; }
        .btn-chinese{ background: linear-gradient(135deg, #F7E9D7 0%, #D4B483 100%); color: #8D2828; border: 1px solid #CCA06C; }
        .btn-journal{ background: #FFF8E1; color: #F57F17; border: 1px dashed #F57F17; }
        .btn-novel  { background: #D7CCC8; color: #5D4037; }
        .btn-matcha { background: #C8E6C9; color: #388E3C; }
        .btn-romantic{ background: linear-gradient(180deg, #E8D4FD 0%, #BBE2FC 100%); color: #6A4F9C; border: 1px solid #D1C4E9; }
        .btn-simple { background: #f5f5f5; color: #333; }
        .btn-portrait{ background: #333; color: #fff; }

        .style-btn.active { 
            transform: scale(0.95); 
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); 
            border: 2px solid currentColor;
        }

        /* è‰²æ¿ */
        .palette-container { display: none; flex-wrap: wrap; gap: 8px; margin-top: 10px; padding: 10px; background: #f9f9f9; border-radius: 8px; }
        .palette-container.show { display: flex; }
        .color-swatch { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .color-swatch:hover { transform: scale(1.1); z-index: 1; }

        /* å¯¹é½æŒ‰é’® */
        .align-group { display: flex; border: 1px solid #eee; border-radius: 6px; overflow: hidden; margin-bottom: 10px; }
        .align-btn { flex: 1; padding: 8px; background: #fff; border: none; cursor: pointer; font-size: 14px; color: #666; border-right: 1px solid #eee; }
        .align-btn:last-child { border-right: none; }
        .align-btn.active { background: var(--primary); color: #fff; }

        input, select, textarea { 
            width: 100%; padding: 12px; border: 1.5px solid #F0F0F0; border-radius: 12px; 
            font-size: 14px; background: #FAFAFA; font-family: inherit; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        input:focus, textarea:focus, select:focus { 
            border-color: var(--primary); 
            background: #fff; 
            box-shadow: 0 0 0 4px rgba(255, 36, 66, 0.05);
            transform: translateY(-1px);
        }
        textarea { height: 140px; resize: vertical; line-height: 1.6; }

        .range-wrap { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .range-label { font-size: 13px; color: #666; width: 64px; }
        input[type="range"] { 
            flex: 1; accent-color: var(--primary); height: 6px; cursor: pointer;
        }
        .range-val { font-size: 12px; font-weight: 700; color: var(--primary); width: 32px; text-align: right; }
  
        /* æ¢å¤æŒ‰é’®æ‚¬æµ®æ•ˆæœ */
        .reset-btn:hover { color: var(--primary) !important; transform: rotate(-45deg); }

         /* ä¾§è¾¹æ åº•éƒ¨æŒ‰é’®æ ·å¼ */
         .sidebar-footer {
             padding: 20px;
             border-top: 1px solid #EEE;
             display: flex;
             gap: 12px;
             background: #fff;
             margin-top: auto;
         }
         .btn-main {
             flex: 1;
             padding: 14px 0;
             border-radius: 14px;
             border: none;
             font-weight: 700;
             cursor: pointer;
             font-size: 14px;
             display: flex;
             align-items: center;
             justify-content: center;
             gap: 8px;
             transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
         }
         .btn-refresh { background: #F3F4F6; color: #1A1A1A; }
         .btn-refresh:hover { background: #E5E7EB; transform: translateY(-2px); }
         .btn-dl { background: #1A1A1A; color: #fff; }
         .btn-dl:hover { background: #000; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }

        .preview-area {
            flex: 1; background-color: #F8F9FB; background-image: radial-gradient(#E5E7EB 1.5px, transparent 1.5px); background-size: 30px 30px;
            padding: 80px; overflow-y: auto; display: flex; flex-direction: column; gap: 40px;
            align-items: center; scroll-behavior: smooth;
        }
        .preview-area.double-column {
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
            gap: 40px;
        }

        /* å³ä¾§æ‚¬æµ®æ§åˆ¶é¢æ¿ - é è¿‘å¡ç‰‡ */
        .right-panel {
            position: fixed; 
            top: 25%; 
            right: 60px;
            width: 300px; /* å¢åŠ å®½åº¦ */
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px);
            border-radius: 20px; 
            padding: 24px 20px; 
            z-index: 100;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border: 1px solid #EEE;
            display: flex; flex-direction: column; gap: 18px; /* å‡å°é—´è·ï¼Œè®©å‚ç›´æ›´ç´§å‡‘ */
            cursor: move; /* æç¤ºå¯æ‹–åŠ¨ */
            user-select: none;
        }
        
        .right-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: -5px; /* è°ƒæ•´é—´è· */
            pointer-events: none; 
        }
        
        .drag-handle {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 20px;
            cursor: move;
            border-radius: 20px 20px 0 0;
            background: rgba(0,0,0,0.02);
        }
        .drag-handle:hover {
            background: rgba(0,0,0,0.05);
        }
        
        @media (max-width: 1400px) {
            .right-panel {
                right: 10px;
                width: 240px; /* å“åº”å¼å®½åº¦ä¹Ÿç›¸åº”å¢åŠ  */
            }
        }

        /* å¼¹çª—ç³»ç»Ÿ - ç¡®ä¿é»˜è®¤éšè— */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center; z-index: 2000;
            opacity: 0; transition: all 0.3s ease;
        }
        .modal-overlay.show { display: flex; opacity: 1; }
        .modal-content {
            background: #fff; padding: 32px; border-radius: 24px; width: 360px;
            max-height: 90vh; overflow-y: auto;
            text-align: center; position: relative; transform: translateY(30px); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 30px 60px rgba(0,0,0,0.2);
        }
        .modal-overlay.show .modal-content { transform: translateY(0); }
        .modal-close { position: absolute; top: 20px; right: 20px; font-size: 24px; color: #CCC; cursor: pointer; transition: 0.2s; }
        .modal-close:hover { color: #333; transform: rotate(90deg); }
        .modal-title { font-size: 22px; font-weight: 900; margin-bottom: 12px; color: #1A1A1A; }
        .modal-subtitle { font-size: 15px; color: #666; margin-bottom: 28px; line-height: 1.6; }
        .modal-qr { 
            width: 100%; 
            max-width: 280px;
            height: auto; 
            border-radius: 12px; 
            margin-bottom: 24px; 
            box-shadow: 0 8px 30px rgba(0,0,0,0.1); 
            border: 1px solid #F0F0F0; 
            object-fit: contain;
        }
        .modal-wechat { 
            background: #F7F8FA; padding: 16px; border-radius: 16px; font-family: 'Monaco', monospace;
            font-size: 18px; font-weight: 800; color: var(--primary); display: flex; align-items: center; justify-content: center; gap: 10px;
            cursor: pointer; transition: all 0.2s; border: 1.5px dashed #E0E0E0;
        }
        .modal-wechat:hover { background: #FFF1F1; border-color: var(--primary); transform: translateY(-2px); }
        .modal-wechat:active { transform: scale(0.98); }
        .copy-hint { font-size: 12px; color: #999; margin-top: 12px; font-weight: 500; }

        .right-panel .group-title { padding-bottom: 8px; font-size: 11px; }
        .right-panel .range-wrap { gap: 8px; margin-bottom: 5px; }
        .right-panel .range-label { width: auto; flex: 1; font-size: 12px; }
        .right-panel .view-toggle-btn { margin-top: 5px; padding: 10px; font-size: 12px; }

        .view-toggle-btn {
            background: #fff;
            border: 1.5px solid #EEE;
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            width: 100%;
            justify-content: center;
        }
        .view-toggle-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        .view-toggle-btn.active {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary);
        }

        /* ========= å¡ç‰‡å®¹å™¨ç³»ç»Ÿ ========= */
        .card-container {
            width: calc(var(--card-w) * var(--card-scale));
            height: calc(var(--card-h) * var(--card-scale));
            display: flex; justify-content: center; align-items: center;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }
        .card-wrapper {
            width: var(--card-w); height: var(--card-h); flex-shrink: 0;
            position: relative; display: flex; justify-content: center; align-items: center;
            transform: scale(var(--card-scale));
            transform-origin: center center;
            animation: cardFadeIn 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }
        @keyframes cardFadeIn {
            from { opacity: 0; transform: scale(calc(var(--card-scale) * 0.95)) translateY(20px); }
            to { opacity: 1; transform: scale(var(--card-scale)) translateY(0); }
        }

        /* 1. æå…‰ (Aurora) */
        .style-aurora.card-wrapper {
            background-color: #F4F7FF;
            background-image: 
                radial-gradient(at top left, rgba(224, 195, 252, 0.6) 0%, transparent 50%),
                radial-gradient(at top right, rgba(142, 197, 252, 0.6) 0%, transparent 50%),
                radial-gradient(at bottom left, rgba(194, 233, 251, 0.6) 0%, transparent 50%),
                radial-gradient(at bottom right, rgba(234, 221, 255, 0.6) 0%, transparent 50%);
        }
        .style-aurora .inner-card {
            width: 94%; height: 96%; 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(10px); 
            border: none; 
            /* ğŸ”´ [ä¿®æ”¹] æå…‰å¡ç‰‡é˜´å½±è°ƒæ•´ï¼Œé¿å…å¯¼å‡ºå‘é»‘ */
            box-shadow: 0 5px 15px 0 rgba(31, 38, 135, 0.08); 
            border-radius: var(--card-radius);
        }
        /* æå…‰æ¨¡å¼å°é¢æ ·å¼ - ä¿æŒè¾ƒå®½è¾¹æ¡† */
        .style-aurora .inner-card.is-cover { width: 90%; height: 92%; }
        
        /* ğŸ”´ [ä¿®æ”¹] æå…‰æ¨¡å¼åŠ ç²—æ–‡å­—é¢œè‰² */
        .style-aurora .markdown-content strong {
            color: #1855D0;
        }

        /* 2. æ¸…æ–° (Fresh) */
        .style-fresh.card-wrapper { background: var(--bg-fresh); }
        .style-fresh .inner-card { width: 94%; height: 96%; background: #ffffff; border-radius: var(--card-radius); box-shadow: 0 20px 40px -10px rgba(0,0,0,0.15); }
        /* æ¸…æ–°æ¨¡å¼å°é¢æ ·å¼ - ä¸æå…‰æ¨¡å¼ä¸€æ ·å®½ */
        .style-fresh .inner-card.is-cover { width: 90%; height: 92%; }

        /* 3. æµªæ¼« (Romantic) */
        .style-romantic.card-wrapper { background: var(--bg-romantic); }
        .style-romantic .inner-card { 
            width: 94%; height: 96%; 
            background: rgba(255, 255, 255, 0.85); 
            border-radius: 16px; 
            border: 1px solid rgba(255,255,255,0.9);
            box-shadow: 0 10px 30px rgba(186, 174, 226, 0.2); 
            backdrop-filter: blur(10px); 
        }
        /* æµªæ¼«æ¨¡å¼å°é¢æ ·å¼ - ä¸æå…‰æ¨¡å¼ä¸€æ ·å®½ */
        .style-romantic .inner-card.is-cover { width: 90%; height: 92%; }

        /* 4. å›½æ½® (Chinese) */
        /* ğŸ”´ [ä¿®æ”¹] å›½æ½®æ¨¡å¼ï¼šå¢å¼ºè§†è§‰æ•ˆæœï¼Œä½¿ç”¨ä¼ ç»Ÿä¸­å›½è‰²å½©å’Œçº¹ç† */
        .style-chinese.card-wrapper { 
            background: var(--bg-chinese);
            position: relative;
        }
        /* æ·»åŠ ä¼ ç»Ÿçº¹ç†èƒŒæ™¯ */
        .style-chinese.card-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23c9ad86' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.3;
            z-index: 0;
        }
        .style-chinese .inner-card { 
            width: 96%; /* ğŸ”´ ç¼©å°è¾¹æ¡†ï¼Œå¢åŠ å†…éƒ¨å®½åº¦ */
            height: 96%; /* ğŸ”´ ç¼©å°è¾¹æ¡†ï¼Œå¢åŠ å†…éƒ¨é«˜åº¦ */
            background-color: #FFF8ED; 
            /* å®£çº¸çº¹ç†æ•ˆæœ */
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(205, 162, 102, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 80% 70%, rgba(205, 162, 102, 0.05) 0%, transparent 20%),
                linear-gradient(rgba(205, 162, 102, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(205, 162, 102, 0.03) 1px, transparent 1px);
            background-size: 100% 100%, 100% 100%, 20px 20px, 20px 20px;
            /* ç§»é™¤åœ†è§’ï¼Œæ”¹ä¸ºæ–¹æ­£è®¾è®¡ */
            border-radius: 2px;
            /* ç®€åŒ–é˜´å½±æ•ˆæœï¼Œç§»é™¤è¾¹æ¡† */
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            /* ç§»é™¤è¾¹æ¡† */
            border: none;
            position: relative;
            overflow: hidden;
        }

        /* å›½æ½®æ¨¡å¼åŠ ç²—æ–‡å­—é¢œè‰² */
        .style-chinese .markdown-content strong {
            color: #8D2828;
            font-weight: 700;
        }
        /* å›½æ½®æ¨¡å¼å°é¢æ ·å¼ - ä¸æå…‰ã€æ¸…æ–°ä¸€è‡´ */
        .style-chinese .inner-card.is-cover { width: 90%; height: 92%; }
        /* å›½æ½®æ¨¡å¼æ ‡é¢˜é¢œè‰² */
        .style-chinese .title {
            color: #8D2828;
        }

        .style-novel.card-wrapper { background: #DEDBD3; }
        .style-novel .inner-card { width: 94%; height: 96%; background-color: #FFFBF0; background-image: linear-gradient(to right, #E0Ddd5 0%, #FFFBF0 5%, #FFFBF0 100%); border-radius: 2px; box-shadow: 2px 2px 10px rgba(0,0,0,0.1); padding-left: 45px !important; }
        .style-novel .inner-card::before { content: ''; position: absolute; top: 0; left: 20px; width: 1px; height: 100%; border-left: 1px dashed #C4BCAF; }

        .style-journal.card-wrapper { background: #f0f0f0; }
        .style-journal .inner-card { width: 92%; height: 94%; background: #fff; background-image: linear-gradient(#e1f5fe 1px, transparent 1px), linear-gradient(90deg, #e1f5fe 1px, transparent 1px); background-size: 20px 20px; border-radius: 10px; box-shadow: 5px 5px 15px rgba(0,0,0,0.05); overflow: visible; }
        .style-journal .inner-card::before { content: ''; position: absolute; top: -15px; left: 50%; transform: translateX(-50%) rotate(-2deg); width: 120px; height: 35px; background: rgba(255, 235, 59, 0.8); box-shadow: 0 2px 5px rgba(0,0,0,0.1); opacity: 0.9; z-index: 2; mask-image: radial-gradient(circle, transparent 2px, black 2.5px); }

        .style-matcha.card-wrapper { background: var(--bg-matcha); }
        .style-matcha .inner-card { width: 90%; height: 92%; background: rgba(255,255,255,0.95); border-radius: 24px; box-shadow: 0 15px 35px rgba(76, 175, 80, 0.2); overflow: hidden; }
        .style-matcha .deco-circle { position: absolute; border-radius: 50%; background: #A5D6A7; opacity: 0.2; }

        .style-simple.card-wrapper { background: transparent; }
        .style-simple .inner-card { width: 100%; height: 100%; background: #fff; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }

        .style-portrait.card-wrapper { background: #000; }
        .style-portrait .inner-card { width: 90%; height: 92%; background: rgba(255,255,255,0.75); backdrop-filter: blur(20px); border-radius: 16px; }
        .style-portrait .inner-card.is-cover {
            width: 100%; height: 100%; border-radius: 0;
            background-image: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 50%, rgba(0,0,0,0.1) 100%), var(--portrait-bg); 
            background-size: cover; background-position: center; color: white; text-shadow: 0 4px 15px rgba(0,0,0,0.9);
        }

        /* === é€šç”¨å¸ƒå±€ === */
        .inner-card { display: flex; flex-direction: column; padding: 32px; position: relative; }

        /* å°é¢å¸ƒå±€ */
        .inner-card.is-cover { padding: 40px; text-align: var(--cover-text-align); font-family: var(--font-cover); }
        .cover-layout { height: 100%; display: flex; flex-direction: column; }
        /* ç¡®ä¿æ— å°é¢å›¾ç‰‡æ—¶æ–‡å­—ä¸Šä¸‹å±…ä¸­ */
        .inner-card.is-cover:not(.style-portrait) .cover-center {
            justify-content: center !important;
        }
        /* å°é¢å›¾ç‰‡å­˜åœ¨æ—¶é ä¸Šå¯¹é½ */
        .inner-card.is-cover:not(.style-portrait) .cover-center.has-image {
            justify-content: flex-start !important;
        }
        .cover-center { flex: 1; display: flex; flex-direction: column; justify-content: flex-start; width: 100%; padding-bottom: 60px; overflow: hidden; align-items: var(--cover-align-items); min-height: 0; }
        
            /* å°é¢æ’å›¾ */
        .cover-image-inset {
            width: 100%;
            aspect-ratio: var(--img-aspect);
            object-fit: var(--img-fit);
            margin: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-radius: 16px !important; 
            width: auto; 
            max-width: 100%; 
            max-height: 320px; /* å¢åŠ æœ€å¤§é«˜åº¦ï¼Œä»200pxå¢åŠ åˆ°320px */
        }
        .style-romantic .cover-image-inset { border: none; box-shadow: 0 8px 20px rgba(0,0,0,0.06); padding: 0; }
        
        .style-journal .cover-image-inset { transform: rotate(-2deg); border: 4px solid #fff; border-radius: 16px !important;}
        .style-chinese .cover-image-inset { border-radius: 16px !important; padding: 0; border: 1px solid #D4B483; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .style-novel .cover-image-inset { filter: sepia(0.3); border: 1px solid #8D6E63; border-radius: 16px !important;}

        /* å°é¢æ ‡é¢˜ */
        .cover-title {
            font-size: calc(36px * var(--cover-scale)); font-weight: 900; line-height: 1.25; margin: 10px 0; width: 100%; white-space: pre-wrap;
            color: var(--title-color, #000000); /* ä½¿ç”¨CSSå˜é‡ï¼Œé»˜è®¤é»‘è‰² */
            background-image: var(--title-gradient, none);
            -webkit-background-clip: var(--title-clip, border-box);
            background-clip: var(--title-clip, border-box);
            -webkit-text-fill-color: var(--title-text-fill, currentColor);
            min-height: 1em;
            flex-shrink: 0;
            /* æ·»åŠ æ¸å˜æ–‡å­—å¯¼å‡ºå…¼å®¹ */
            display: inline-block;
            width: 100%;
        }
        /* ä¸»é¢˜é»˜è®¤æ ‡é¢˜æ ·å¼ */
        .style-aurora .cover-title.default-gradient,
        .style-journal .cover-title.default-gradient,
        .style-romantic .cover-title.default-gradient {
            /* ä½¿ç”¨CSSå˜é‡æ§åˆ¶æ ·å¼ï¼Œé»˜è®¤é»‘è‰² */
            background-image: var(--title-gradient, none);
            -webkit-background-clip: var(--title-clip, border-box);
            background-clip: var(--title-clip, border-box);
            -webkit-text-fill-color: var(--title-text-fill, currentColor);
        }
        /* å›½æ½®é£æ ¼é»˜è®¤æ ‡é¢˜é¢œè‰²ï¼šä½¿ç”¨æŸ”å’Œçš„çº¢è‰²ï¼Œå¯è°ƒæ•´ */
        .style-chinese .cover-title.default-gradient {
            /* ä½¿ç”¨CSSå˜é‡æ§åˆ¶æ ·å¼ï¼Œå…è®¸ç”¨æˆ·è°ƒæ•´ */
            background-image: var(--title-gradient, none);
            -webkit-background-clip: var(--title-clip, border-box);
            background-clip: var(--title-clip, border-box);
            -webkit-text-fill-color: var(--title-text-fill, currentColor);
            color: var(--title-color, #8D2828);
        }
        /* æ¸…æ–°é£æ ¼é»˜è®¤æ ‡é¢˜é¢œè‰²ï¼šä½¿ç”¨ç¬¬å…­ä¸ªæ¸å˜è‰²ï¼ˆæ¸…æ–°è“ï¼‰ */
        .style-fresh .cover-title.default-gradient {
            /* ä½¿ç”¨CSSå˜é‡æ§åˆ¶æ ·å¼ï¼Œå…è®¸ç”¨æˆ·è°ƒæ•´ */
            background-image: var(--title-gradient, linear-gradient(180deg, #2980b9 0%, #73c8a9 100%));
            -webkit-background-clip: var(--title-clip, text);
            background-clip: var(--title-clip, text);
            -webkit-text-fill-color: var(--title-text-fill, transparent);
            color: var(--title-color, transparent);
        }
        /* è°ƒæ•´å›¾ç‰‡åœ¨æ–‡å­—ä¸‹æ–¹æ—¶çš„å°é¢æ’ç‰ˆ - ä¿®å¤æ–‡å­—æ”¾å¤§æŒ¤å‹å›¾ç‰‡é—®é¢˜ */
        .cover-center.bottom-image {
            justify-content: flex-start !important;
            padding-top: 10px;
            padding-bottom: 60px;
            flex-direction: column;
        }
        /* ç¡®ä¿æ ‡é¢˜æ”¾å¤§æ—¶å‘ä¸Šæ‰©å±•ï¼Œä¸æŒ¤å‹å›¾ç‰‡ */
        .cover-center.bottom-image .cover-title {
            margin-bottom: auto;
        }
        /* æµªæ¼«æ¨¡å¼ä¸‹å‰¯æ ‡é¢˜è®¾ç½® */
        .style-romantic .cover-sub {
            color: #000000;
        }
        .cover-sub { font-size: 16px; color: #333; line-height: 1.6; white-space: pre-wrap; width: 100%; }
        /* æµªæ¼«æ¨¡å¼å‰¯æ ‡é¢˜é€‚é…ä¸­ç­‰èƒŒæ™¯ */
        .style-romantic .cover-sub { color: #000000; }

        .issue-tag { font-size: 10px; letter-spacing: 2px; color: #999; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px; text-transform: uppercase; width: 100%; }
        
        /* å°é¢é¡µè„š */
        .cover-footer { 
            position: absolute; bottom: 30px; left: 40px; right: 40px;
            display: flex; justify-content: space-between; font-size: 12px; color: #aaa; 
            border-top: 1px solid #eee; padding-top: 15px; align-items: center; letter-spacing: 1px; 
            height: 40px;
        }
        .style-romantic .cover-footer { border-top-color: rgba(0,0,0,0.05); color: #9FA8DA; }

        /* æ­£æ–‡å¸ƒå±€ */
        .content-body { 
            flex: 1; overflow: hidden; display: flex; flex-direction: column; 
            padding-bottom: 30px;
        }
        .markdown-content { color: var(--content-text-color); line-height: 1.6; }
        /* æ ‡é¢˜å±‚çº§ H1 > H2 > H3 */
        .markdown-content h1 { 
            font-family: var(--font-content-head); 
            font-size: calc(1.6em * var(--content-scale)); 
            margin: 0.5em 0 0.3em; color: var(--content-head-color); font-weight: 800; 
        }
        .markdown-content h2 { 
            font-family: var(--font-content-head); 
            font-size: calc(1.3em * var(--content-scale)); 
            margin: 0.5em 0 0.3em; color: var(--content-head-color); font-weight: 800; 
        }
        .markdown-content h3 { 
            font-family: var(--font-content-head); 
            font-size: calc(1.1em * var(--content-scale)); 
            margin: 0.5em 0 0.3em; color: var(--content-head-color); font-weight: 700; 
        }
        .markdown-content p, .markdown-content li { font-family: var(--font-content-body); font-size: var(--body-size); margin-bottom: 0.5em; text-align: justify; }
        .markdown-content ul { padding-left: 1.2em; margin-bottom: 0.5em; }
        .markdown-content strong { color: var(--strong-color); font-weight: 800; }
        
        /* æµªæ¼«æ¨¡å¼æ­£æ–‡é¢œè‰² */
        .style-romantic .markdown-content { color: var(--content-text-color); }

        /* æ­£æ–‡å›¾ç‰‡ */
        .img-container { margin: 15px 0; text-align: center; position: relative; }
        /* [ä¿®æ”¹] é™åˆ¶å›¾ç‰‡æœ€å¤§é«˜åº¦ */
        .img-container img {
            max-width: 100%;
            max-height: 320px; /* é™åˆ¶é«˜åº¦ï¼Œé˜²æ­¢ä¸€å¼ å›¾å æ»¡æ•´ä¸ªå¡ç‰‡å¯¼è‡´æº¢å‡º */
            height: auto;
            display: block;
            margin: 0 auto;
            object-fit: contain;
        }
        .style-aurora .img-container img, .style-fresh .img-container img, .style-romantic .img-container img, .style-matcha .img-container img { border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .style-journal .img-container img { transform: rotate(1deg); border: 5px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .style-chinese .img-container img { border: 1px solid #D4B483; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 0; }
        .style-novel .img-container img { filter: sepia(0.2); }

        .content-footer {
            margin-top: auto; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; font-size: 12px; color: #888; align-items: center;
            flex-shrink: 0; background: transparent; letter-spacing: 2px;
            position: relative; z-index: 10;
        }
        .style-romantic .content-footer { border-top-color: rgba(0,0,0,0.05); color: #9FA8DA; }
        .footer-left { font-weight: bold; color: #666; margin-right: 30px; letter-spacing: 2px; }

        /* äººåƒé£æ ¼ */
        .style-portrait .cover-layout { justify-content: center; }
        .style-portrait .cover-center { flex: 1; justify-content: center; align-items: center; text-align: center; padding-bottom: 0; }
        .style-portrait .cover-title { color: #fff; text-align: center; margin-bottom: 15px; -webkit-text-fill-color: white; text-shadow: 0 2px 5px rgba(0,0,0,0.8); }
        .style-portrait .cover-sub { color: rgba(255,255,255,0.9); text-align: center; }
        .style-portrait .cover-footer, .style-portrait .issue-tag, .style-portrait .cover-image-inset { display: none; }

        @media (max-width: 900px) {
            body { flex-direction: column; overflow: auto; height: auto; }
            .sidebar { width: 100%; height: auto; }
            .card-wrapper { transform: scale(0.7); margin-bottom: -130px; }
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-resizer" id="sidebarResizer"></div>
        <div class="sidebar-header">
            <div class="logo">REDNOTE <span>PRO</span></div>
        </div>
        
        <div class="sidebar-content">
            <div>
                <div class="group-title"><i class="ph-duotone ph-palette"></i> é£æ ¼é€‰æ‹© / Style</div>
                <div class="style-grid">
                    <div class="style-btn btn-aurora" onclick="setStyle('style-aurora', '#0056FF', this)">
                        <span>æå…‰</span>
                    </div>
                    <div class="style-btn btn-fresh" onclick="setStyle('style-fresh', '#0277BD', this)">
                        <span>æ¸…æ–°</span>
                    </div>
                    <div class="style-btn btn-chinese" onclick="setStyle('style-chinese', '#8D2828', this)">
                        <span>å›½æ½®</span>
                    </div>
                    
                    <div class="style-btn btn-journal" onclick="setStyle('style-journal', '#F57F17', this)">
                        <span>æ‰‹å¸</span>
                    </div>
                    <div class="style-btn btn-novel" onclick="setStyle('style-novel', '#5D4037', this)">
                        <span>å°è¯´</span>
                    </div>
                    <div class="style-btn btn-matcha" onclick="setStyle('style-matcha', '#388E3C', this)">
                        <span>æŠ¹èŒ¶</span>
                    </div>

                    <div class="style-btn btn-romantic" onclick="setStyle('style-romantic', '#2b53c9', this)">
                        <span>æµªæ¼«</span>
                    </div>
                    <div class="style-btn btn-simple" onclick="setStyle('style-simple', '#FF2442', this)">
                        <span>æç®€</span>
                    </div>
                    <div class="style-btn btn-portrait" onclick="setStyle('style-portrait', '#fff', this)">
                        <span>äººåƒ</span>
                    </div>
                </div>
            </div>

            <div>
                <div class="group-title" onclick="toggleFontSettings()" style="cursor:pointer; display:flex; justify-content:space-between; align-items:center;">
                    <span><i class="ph-duotone ph-text-t"></i> å­—ä½“è®¾ç½® / Fonts</span>
                    <span id="fontSettingsToggle"><i class="ph ph-caret-down"></i></span>
                </div>
                <div id="fontSettingsContainer" style="display:none;">
                    <label style="font-size:12px;color:#666;display:block;margin-bottom:4px;margin-top:5px;">å°é¢å­—ä½“</label>
                    <select id="fontCoverSelect" onchange="render()" style="margin-bottom:8px;">
                        <option value="'Noto Serif SC', serif" selected>æ€æºå®‹ä½“ (é»˜è®¤)</option>
                        <option value="'PingFang SC', sans-serif">æ ‡å‡†é»‘ä½“</option>
                        <option value="'KaiTi', 'STKaiti', serif">ç³»ç»Ÿæ¥·ä½“</option>
                        <option value="'LXGW WenKai Screen', sans-serif">éœé¹œæ–‡æ¥·</option>
                        <option value="'Ma Shan Zheng', cursive">é©¬å–„æ”¿ä¹¦æ³•</option>
                        <option value="'ZCOOL XiaoWei', serif">ç«™é…·å°è–‡</option>
                    </select>

                    <label style="font-size:12px;color:#666;display:block;margin-bottom:4px;">æ­£æ–‡æ ‡é¢˜</label>
                    <select id="fontHeadSelect" onchange="render()" style="margin-bottom:8px;">
                        <option value="'Noto Serif SC', serif" selected>æ€æºå®‹ä½“</option>
                        <option value="'PingFang SC', sans-serif">æ ‡å‡†é»‘ä½“</option>
                        <option value="'KaiTi', 'STKaiti', serif">ç³»ç»Ÿæ¥·ä½“</option>
                        <option value="'LXGW WenKai Screen', sans-serif">éœé¹œæ–‡æ¥·</option>
                    </select>

                    <label style="font-size:12px;color:#666;display:block;margin-bottom:4px;">æ­£æ–‡å†…å®¹</label>
                    <select id="fontBodySelect" onchange="render()" style="margin-bottom:12px;">
                        <option value="'PingFang SC', sans-serif" selected>æ ‡å‡†é»‘ä½“ (é»˜è®¤)</option>
                        <option value="'Noto Serif SC', serif">æ€æºå®‹ä½“</option>
                        <option value="'KaiTi', 'STKaiti', serif">ç³»ç»Ÿæ¥·ä½“</option>
                        <option value="'LXGW WenKai Screen', sans-serif">éœé¹œæ–‡æ¥·</option>
                    </select>
                </div>
            </div>
            
            <!-- æ­£æ–‡é¢œè‰²è®¾ç½® -->
            <div>
                <div class="group-title" onclick="toggleContentColors()" style="cursor:pointer; display:flex; justify-content:space-between; align-items:center;">
                    <span><i class="ph-duotone ph-swatches"></i> æ­£æ–‡é¢œè‰² / Colors</span>
                    <div style="display:flex; align-items:center; gap:8px;">
                        <button onclick="resetContentColors(event)" title="æ¢å¤é»˜è®¤é¢œè‰²" class="reset-btn" style="background:none; border:none; color:#AAA; cursor:pointer; font-size:14px; padding:2px; display:flex; align-items:center; transition:all 0.3s;"><i class="ph ph-arrow-counter-clockwise"></i></button>
                        <span id="contentColorsToggle"><i class="ph ph-caret-down"></i></span>
                    </div>
                </div>
                <div id="contentColorsContainer" style="display:none;">
                    <div style="display:flex; gap:8px; margin-top:5px;">
                        <div style="flex:1; text-align:center;">
                            <label style="font-size:11px;color:#666;display:block;margin-bottom:4px;">æ ‡é¢˜</label>
                            <div style="display:flex; align-items:center; gap:4px; justify-content:center;">
                                <input type="color" id="contentHeadColor" value="#000000" onchange="updateContentHeadColor()" style="width:28px; height:28px; padding:0; border:1px solid #ddd; cursor:pointer; border-radius:4px;">
                            </div>
                        </div>
                        <div style="flex:1; text-align:center;">
                            <label style="font-size:11px;color:#666;display:block;margin-bottom:4px;">æ­£æ–‡</label>
                            <div style="display:flex; align-items:center; gap:4px; justify-content:center;">
                                <input type="color" id="contentTextColor" value="#000000" onchange="updateContentTextColor()" style="width:28px; height:28px; padding:0; border:1px solid #ddd; cursor:pointer; border-radius:4px;">
                            </div>
                        </div>
                        <div style="flex:1; text-align:center;">
                            <label style="font-size:11px;color:#666;display:block;margin-bottom:4px;">åŠ ç²—</label>
                            <div style="display:flex; align-items:center; gap:4px; justify-content:center;">
                                <input type="color" id="contentStrongColor" value="#2b53c9" onchange="updateContentStrongColor()" style="width:28px; height:28px; padding:0; border:1px solid #ddd; cursor:pointer; border-radius:4px;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ’ç‰ˆç»†èŠ‚ç§»è‡³å³ä¾§æ‚¬æµ®çª—ï¼Œè¿™é‡Œä¿ç•™å…³é”®æ‹‰æ† -->
            <div>
                <div class="group-title" onclick="toggleLayoutSettings()" style="cursor:pointer; display:flex; justify-content:space-between; align-items:center;">
                    <span><i class="ph-duotone ph-text-aa"></i> æ ‡é¢˜æ­£æ–‡ç»†èŠ‚ / Details</span>
                    <span id="layoutSettingsToggle"><i class="ph ph-caret-up"></i></span>
                </div>
                <div id="layoutSettingsContainer" style="display:block;margin-top:5px;">
                    <div class="range-wrap">
                        <span class="range-label">å°é¢æ ‡é¢˜</span>
                        <input type="range" id="coverScale" min="0.8" max="2.0" step="0.1" value="1.0" oninput="updateParams()">
                        <span class="range-val" id="cvVal">1.0</span>
                    </div>
                    <div class="range-wrap">
                        <span class="range-label">æ­£æ–‡æ ‡é¢˜</span>
                        <input type="range" id="contentScale" min="0.8" max="1.5" step="0.1" value="1.0" oninput="updateParams()">
                        <span class="range-val" id="ctVal">1.0</span>
                    </div>
                    <div class="range-wrap">
                        <span class="range-label">æ­£æ–‡å¤§å°</span>
                        <input type="range" id="bodySize" min="12" max="24" value="16" oninput="updateParams()">
                        <span class="range-val" id="bsVal">16</span>
                    </div>
                    <div class="range-wrap">
                        <span class="range-label">æ–‡å­—å¯†åº¦</span>
                        <input type="range" id="density" min="100" max="600" value="200" oninput="updateParams()">
                        <span class="range-val" id="dsVal">200</span>
                    </div>
                </div>
            </div>

            <div>
                <div class="group-title" onclick="toggleCoverSettings()" style="cursor:pointer; display:flex; justify-content:space-between; align-items:center;">
                    <span><i class="ph-duotone ph-image"></i> å°é¢è®¾ç½® / Cover</span>
                    <span id="coverSettingsToggle"><i class="ph ph-caret-down"></i></span>
                </div>
                <div id="coverSettingsContainer" style="display:none;">
                
                <div style="background:#f9f9f9; padding:10px; border-radius:8px; border:1px dashed #ddd; margin-bottom:10px;margin-top:5px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                        <div style="font-size:12px; color:#666;">æ’å›¾ / èƒŒæ™¯å›¾</div>
                        <button onclick="removeCoverImage()" style="font-size:12px; padding:2px 6px; border:none; background:#eee; border-radius:4px; cursor:pointer; color:red;">ğŸ—‘ï¸ åˆ é™¤</button>
                    </div>
                    <input type="file" id="coverImageUpload" accept="image/*" style="width:100%; margin-bottom:8px;">
                    
                    <div style="display:flex; flex-direction:column; gap:8px;">
                        <label style="font-size:12px; color:#666; display:flex; align-items:center; justify-content:space-between;">
                            <span>å›¾ç‰‡æ¯”ä¾‹:</span>
                            <select id="imgRatioSelect" onchange="updateParams()" style="width:60%; padding:4px;">
                                <option value="auto">åŸå§‹æ¯”ä¾‹ (å®Œæ•´)</option>
                                <option value="1 / 1">1:1 æ­£æ–¹å½¢ (å¡«å……)</option>
                                <option value="4 / 3">4:3 æ ‡å‡† (å¡«å……)</option>
                                <option value="16 / 9">16:9 å®½å± (å¡«å……)</option>
                            </select>
                        </label>
                        
                        <label style="font-size:12px; color:#666; display:flex; align-items:center; justify-content:space-between;">
                            <span>æ˜¾ç¤ºä½ç½®:</span>
                            <select id="imgPosSelect" onchange="render()" style="width:60%; padding:4px;">
                                <option value="top">æ ‡é¢˜ä¸Šæ–¹ (é»˜è®¤)</option>
                                <option value="bottom">æ–‡å­—ä¸‹æ–¹</option>
                            </select>
                        </label>
                    </div>
                </div>
                
                <div style="margin-bottom:10px;">
                    <div style="font-size:12px; color:#666; margin-bottom:5px;">å°é¢å¸ƒå±€</div>
                    <div class="align-group">
                        <button class="align-btn" onclick="setAlign('left')">â¬…ï¸ å·¦å¯¹é½</button>
                        <button class="align-btn active" onclick="setAlign('center')">âº å±…ä¸­</button>
                        <button class="align-btn" onclick="setAlign('right')">â¡ï¸ å³å¯¹é½</button>
                    </div>
                </div>

                <div style="margin-bottom:10px;">
                    <div style="font-size:12px; color:#666; margin-bottom:5px; display:flex; justify-content:space-between; align-items:center;">
                        <span>æ ‡é¢˜è‰²å½©</span>
                        <div style="display:flex; gap:5px;">
                            <input type="color" id="titleColorPicker" value="#000000" onchange="updateTitleColor('solid')" style="width:24px; height:24px; padding:0; border:none; cursor:pointer; border-radius:4px;">
                            <button onclick="togglePalette()" style="font-size:12px; border:1px solid #ddd; background:#fff; border-radius:4px; cursor:pointer; padding:2px 6px;">ğŸ¨ é¢„è®¾</button>
                            <button onclick="addColorPreset()" style="font-size:12px; border:1px solid #ddd; background:#fff; border-radius:4px; cursor:pointer; padding:2px 6px;">â• æ·»åŠ </button>
                            <button onclick="updateTitleColor('reset')" style="font-size:12px; border:1px solid #ddd; background:#fff; border-radius:4px; cursor:pointer; padding:2px 6px;">â†º</button>
                        </div>
                    </div>
                    <div class="palette-container" id="paletteContainer">
                        <div id="colorPalette" style="display:flex; flex-wrap:wrap; gap:8px;"></div>
                        <div style="margin-top:8px; font-size:11px; color:#999;">ç‚¹å‡»é¢œè‰²å¯åº”ç”¨ï¼Œå³é”®ç‚¹å‡»å¯åˆ é™¤</div>
                    </div>
                </div>
                
                <!-- ä¸åŒæ ·å¼å¯¼å‡ºæ—¶çš„æ ‡é¢˜è‰²å½©è®¾ç½® -->
                <div style="margin-bottom:10px;">
                    <div class="group-title" onclick="toggleStyleColors()" style="cursor:pointer; display:flex; justify-content:space-between; align-items:center;">
                        <span><i class="ph-duotone ph-palette"></i> å¯¼å‡ºè‰²å½© / Export</span>
                        <span id="styleColorsToggle"><i class="ph ph-caret-down"></i></span>
                    </div>
                    <div id="styleColorsContainer" style="display:none;">
                        <div style="font-size:11px; color:#999; margin-bottom:8px;">è®¾ç½®ä¸åŒæ ·å¼å¯¼å‡ºæ—¶çš„é»˜è®¤æ ‡é¢˜è‰²å½©</div>
                        <div style="display:flex; flex-direction:column; gap:12px;">
                            <!-- æå…‰æ ·å¼ -->
                            <div>
                                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:4px;">
                                    <label style="font-size:12px; color:#666; display:flex; align-items:center; gap:5px;">
                                        <span style="width:60px;">æå…‰æ ·å¼</span>
                                        <input type="color" id="auroraTitleColor" value="#4d91ea" style="width:24px; height:24px; padding:0; border:none; cursor:pointer; border-radius:4px;">
                                    </label>
                                </div>
                                <div class="palette-container" id="auroraPalette" style="margin-left:65px; margin-bottom:8px; display:flex; flex-wrap:wrap; gap:6px;"></div>
                            </div>
                            <!-- æ¸…æ–°æ ·å¼ -->
                            <div>
                                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:4px;">
                                    <label style="font-size:12px; color:#666; display:flex; align-items:center; gap:5px;">
                                        <span style="width:60px;">æ¸…æ–°æ ·å¼</span>
                                        <input type="color" id="freshTitleColor" value="#4d91ea" style="width:24px; height:24px; padding:0; border:none; cursor:pointer; border-radius:4px;">
                                    </label>
                                </div>
                                <div class="palette-container" id="freshPalette" style="margin-left:65px; margin-bottom:8px; display:flex; flex-wrap:wrap; gap:6px;"></div>
                            </div>
                            <!-- æµªæ¼«æ ·å¼ -->
                            <div>
                                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:4px;">
                                    <label style="font-size:12px; color:#666; display:flex; align-items:center; gap:5px;">
                                        <span style="width:60px;">æµªæ¼«æ ·å¼</span>
                                        <input type="color" id="romanticTitleColor" value="#2b53c9" style="width:24px; height:24px; padding:0; border:none; cursor:pointer; border-radius:4px;">
                                    </label>
                                </div>
                                <div class="palette-container" id="romanticPalette" style="margin-left:65px; margin-bottom:8px; display:flex; flex-wrap:wrap; gap:6px;"></div>
                            </div>
                            <!-- å›½æ½®æ ·å¼ -->
                            <div>
                                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:4px;">
                                    <label style="font-size:12px; color:#666; display:flex; align-items:center; gap:5px;">
                                        <span style="width:60px;">å›½æ½®æ ·å¼</span>
                                        <input type="color" id="chineseTitleColor" value="#8D2828" style="width:24px; height:24px; padding:0; border:none; cursor:pointer; border-radius:4px;">
                                    </label>
                                </div>
                                <div class="palette-container" id="chinesePalette" style="margin-left:65px; margin-bottom:8px; display:flex; flex-wrap:wrap; gap:6px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
                
                <!-- ä»¥ä¸‹å†…å®¹ä¸æŠ˜å  -->
                <div style="display:flex; align-items:center; gap:5px; margin-bottom:8px; font-size:12px;">
                    <input type="checkbox" id="showIssue" onchange="render()" style="width:auto;"> æ˜¾ç¤ºåˆŠå· (é»˜è®¤å…³)
                </div>
                <div style="display:flex; gap:5px;">
                     <input type="text" id="issueText" value="VOL.01 | 2025" placeholder="åˆŠå·" style="font-family:monospace; margin-bottom:8px;">
                     <input type="text" id="coverFooterRight" value="" placeholder="å³ä¸‹è§’æ–‡å­—(é»˜è®¤ç©º)" style="margin-bottom:8px;">
                </div>
                <textarea id="mainTitle" placeholder="å¤§æ ‡é¢˜" style="height:60px; font-weight:bold; margin-bottom:8px;">RedNote Pro</textarea>
                <textarea id="subTitle" placeholder="å‰¯æ ‡é¢˜" style="height:50px;">ç»†èŠ‚è´¨æ„Ÿç²¾ä¿®ç‰ˆä½¿ç”¨æ‰‹å†Œ</textarea>
            </div>
            <div>
                <div class="group-title"><i class="ph-duotone ph-article"></i> æ­£æ–‡å†…å®¹ / Content</div>
                <div style="margin-bottom: 8px; display: flex; gap: 8px;">
                    <button onclick="document.getElementById('bodyImageUpload').click()" class="view-toggle-btn" style="width: auto; flex: 1; padding: 6px 12px; font-size: 12px; border-style: dashed;">
                        <i class="ph-duotone ph-image-square"></i> æ’å…¥å›¾ç‰‡ (æ”¯æŒæœ¬åœ°ä¸Šä¼ )
                    </button>
                    <input type="file" id="bodyImageUpload" accept="image/*" style="display:none;" onchange="insertBodyImage(this)">
                </div>
                <textarea id="bodyText" style="height:150px; max-width:100%;" placeholder="åœ¨æ­¤è¾“å…¥æ­£æ–‡..." oninput="render()"># RedNote Pro ä½¿ç”¨æŒ‡å—

## æ ¸å¿ƒåŠŸèƒ½ä»‹ç»
RedNote Pro æ˜¯ä¸€æ¬¾ä¸“ä¸ºè‡ªåª’ä½“åˆ›ä½œè€…è®¾è®¡çš„**ç»†èŠ‚è´¨æ„Ÿå¡ç‰‡ç”Ÿæˆå™¨**ã€‚å®ƒèƒ½å¸®åŠ©æ‚¨å¿«é€Ÿå°†æ–‡å­—è½¬åŒ–ä¸ºç²¾ç¾çš„å°çº¢ä¹¦é£æ ¼åˆ†äº«å›¾ã€‚

### 1. å¤šæ ·åŒ–é£æ ¼é€‰æ‹©
- **æå…‰ & æµªæ¼«**ï¼šé€‚åˆæƒ…æ„Ÿã€æ–‡å­¦ç±»å†…å®¹ã€‚
- **å›½æ½® & å°è¯´**ï¼šä¼ æ‰¿ç»å…¸ï¼Œæå…·ä¸œæ–¹éŸµå‘³ã€‚
- **æ¸…æ–° & æŠ¹èŒ¶**ï¼šç”Ÿæ´»æ–¹å¼ã€ç§‘æ™®å¹²è´§çš„é¦–é€‰ã€‚

### 2. é«˜åº¦è‡ªå®šä¹‰æ’ç‰ˆ
æ‚¨å¯ä»¥å®æ—¶è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š
*   **å­—ä½“è®¾ç½®**ï¼šæ”¯æŒæ€æºå®‹ä½“ã€éœé¹œæ–‡æ¥·ç­‰å¤šç§ç²¾é€‰å­—ä½“ã€‚
*   **è‰²å½©ç»†èŠ‚**ï¼šä»æ ‡é¢˜åˆ°æ­£æ–‡ï¼Œæ¯ä¸€å¤„é¢œè‰²éƒ½å¯è‡ªç”±å®šä¹‰ã€‚
*   **è§†å›¾æ§åˆ¶**ï¼šå³ä¾§æ‚¬æµ®é¢æ¿æ”¯æŒè‡ªç”±æ‹–æ‹½ã€å¡ç‰‡ç¼©æ”¾åŠå•åŒæ åˆ‡æ¢ã€‚

  ![WechatIMG20.jpeg](https://pic-1314100616.cos.ap-nanjing.myqcloud.com/img/WechatIMG20.jpeg)

---
é“¾æ¥ä½œè€…è‹¥è½©è€å¸ˆè·å¾—æ›´å¤šå¸®åŠ©</textarea>
                <div id="localImageGallery" style="margin-top: 10px; display: none; flex-wrap: wrap; gap: 8px; padding: 10px; background: #F9F9F9; border-radius: 8px; border: 1px solid #EEE;"></div>
                <div style="margin-top:10px;">
                    <input type="text" id="footerText" value="è½©è¾•å§“å" placeholder="ä½œè€…ç½²å">
                </div>
            </div>
        </div>
        <div class="sidebar-footer">
            <button class="btn-main btn-refresh" onclick="render()">ğŸ”„ åˆ·æ–°</button>
            <button class="btn-main btn-dl" id="dlBtn" onclick="downloadAll()">â¬‡ï¸ ä¸‹è½½ ZIP</button>
        </div>
        <div style="padding: 0 20px 20px;">
            <button class="contact-btn" onclick="toggleModal(true)">
                <i class="ph-duotone ph-chat-circle-dots"></i>
                <span>è”ç³»ä½œè€…</span>
            </button>
        </div>
    </div>

    <div class="right-panel" id="rightPanel">
        <div class="drag-handle" id="rightPanelHandle"></div>
        <div class="group-title"><i class="ph-duotone ph-monitor"></i> è§†å›¾æ§åˆ¶ / View</div>
        <div class="range-wrap">
            <span class="range-label">å¡ç‰‡ç¼©æ”¾</span>
            <input type="range" id="cardZoom" min="0.4" max="1.5" step="0.05" value="1.0" oninput="updateParams()">
            <span class="range-val" id="czVal">100%</span>
        </div>
        <button class="view-toggle-btn" id="columnToggle" onclick="toggleColumns()">
            <i class="ph-duotone ph-columns"></i>
            <span>åˆ‡æ¢åŒæ </span>
        </button>
    </div>

    <div class="preview-area" id="previewArea"></div>

    <!-- è”ç³»ä½œè€…å¼¹çª— -->
    <div class="modal-overlay" id="contactModal" onclick="if(event.target===this) toggleModal(false)">
        <div class="modal-content">
            <div class="modal-close" onclick="toggleModal(false)"><i class="ph ph-x"></i></div>
            <div class="modal-title">è”ç³»è‹¥è½©è€å¸ˆ</div>
            <div class="modal-subtitle">ç‚¹å‡»ä¸‹æ–¹å¾®ä¿¡å·å³å¯å¿«é€Ÿå¤åˆ¶ï¼Œæ·»åŠ è€å¸ˆå’¨è¯¢</div>
            
            <div class="modal-wechat" onclick="copyWeChat()">
                <i class="ph-duotone ph-copy"></i>
                <span id="wechatId">fashou789</span>
            </div>
            <div class="copy-hint">å¾®ä¿¡å·ï¼šfashou789</div>
        </div>
    </div>

    <div style="display:none;">
        <svg id="icon-diamond" viewBox="0 0 24 24"><path d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M12,16l-4-4l4-4l4,4L12,16z"/></svg>
    </div>

    <script>
        let currentStyle = 'style-aurora';
        let currentStrongColor = '#6200EE';
        let uploadedCoverImage = null;
        
        // ç”¨äºå­˜å‚¨æ­£æ–‡æœ¬åœ°å›¾ç‰‡çš„æ˜ å°„è¡¨ï¼Œé˜²æ­¢æ­£æ–‡æ¡†æ˜¾ç¤ºè¶…é•¿ä»£ç 
        let bodyImageMap = {};
        let bodyImageCounter = 1;

        // ä¾§è¾¹æ è°ƒæ•´å®½åº¦é€»è¾‘
        const sidebar = document.querySelector('.sidebar');
        const resizer = document.getElementById('sidebarResizer');
        let isResizing = false;

        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            resizer.classList.add('resizing');
            document.body.style.cursor = 'col-resize';
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', stopResizing);
        });

        function handleMouseMove(e) {
            if (!isResizing) return;
            const newWidth = Math.max(260, Math.min(600, e.clientX));
            document.documentElement.style.setProperty('--sidebar-w', newWidth + 'px');
        }

        function stopResizing() {
            isResizing = false;
            resizer.classList.remove('resizing');
            document.body.style.cursor = 'default';
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', stopResizing);
        }

        // å³ä¾§é¢æ¿æ‹–æ‹½é€»è¾‘
        const rightPanel = document.getElementById('rightPanel');
        const dragHandle = document.getElementById('rightPanelHandle');
        let isDragging = false;
        let startX, startY, initialX, initialY, offsetX, offsetY;

        dragHandle.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            initialX = rightPanel.offsetLeft;
            initialY = rightPanel.offsetTop;
            
            // è®°å½•ç›¸å¯¹äºé¢æ¿å·¦ä¸Šè§’çš„åç§»ï¼Œé˜²æ­¢çªè·³
            const rect = rightPanel.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            document.addEventListener('mousemove', handleDrag);
            document.addEventListener('mouseup', stopDragging);
        });

        function handleDrag(e) {
            if (!isDragging) return;
            const x = e.clientX - offsetX;
            const y = e.clientY - offsetY;
            rightPanel.style.left = x + 'px';
            rightPanel.style.top = y + 'px';
            rightPanel.style.right = 'auto'; 
            rightPanel.style.bottom = 'auto';
            rightPanel.style.transform = 'none'; // ç§»é™¤å¯èƒ½å­˜åœ¨çš„ transform
        }

        function stopDragging() {
            isDragging = false;
            document.removeEventListener('mousemove', handleDrag);
            document.removeEventListener('mouseup', stopDragging);
        }

        // è§†å›¾åˆ‡æ¢æ§åˆ¶
        function toggleColumns() {
            const previewArea = document.getElementById('previewArea');
            const toggleBtn = document.getElementById('columnToggle');
            const isDouble = previewArea.classList.toggle('double-column');
            
            toggleBtn.classList.toggle('active', isDouble);
            toggleBtn.querySelector('span').innerText = isDouble ? 'åˆ‡æ¢å•æ æ˜¾ç¤º' : 'åˆ‡æ¢åŒæ æ˜¾ç¤º';
            toggleBtn.querySelector('i').className = isDouble ? 'ph-duotone ph-rows' : 'ph-duotone ph-columns';
        }

        // å¼¹çª—æ§åˆ¶
        function toggleModal(show) {
            const modal = document.getElementById('contactModal');
            if (show) {
                modal.classList.add('show');
            } else {
                modal.classList.remove('show');
            }
        }

        // å¤åˆ¶å¾®ä¿¡å·
        function copyWeChat() {
            const wechatId = document.getElementById('wechatId').innerText;
            navigator.clipboard.writeText(wechatId).then(() => {
                const hint = document.querySelector('.copy-hint');
                const oldText = hint.innerText;
                hint.innerText = 'âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿';
                hint.style.color = '#4CAF50';
                setTimeout(() => {
                    hint.innerText = oldText;
                    hint.style.color = '#999';
                }, 2000);
            });
        }

        // æ’å…¥æ­£æ–‡å›¾ç‰‡åŠŸèƒ½ (ä¼˜åŒ–ç‰ˆï¼šä½¿ç”¨å ä½ç¬¦ï¼Œé˜²æ­¢æ­£æ–‡æ¡†å‡ºç°é•¿ä»£ç )
        function insertBodyImage(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64 = e.target.result;
                const imgId = `IMG_${bodyImageCounter++}`;
                
                // å°†æ•°æ®å­˜å…¥æ˜ å°„è¡¨
                bodyImageMap[imgId] = base64;
                
                const textarea = document.getElementById('bodyText');
                const start = textarea.selectionStart;
                const end = textarea.selectionEnd;
                const text = textarea.value;
                
                // æ„é€ ç®€æ´çš„å ä½ç¬¦ï¼š![æ–‡ä»¶å](ç¼–å·)
                const imageMarkdown = `\n\n![${file.name}](${imgId})\n\n`;
                
                // åœ¨å…‰æ ‡ä½ç½®æ’å…¥å ä½ç¬¦
                textarea.value = text.substring(0, start) + imageMarkdown + text.substring(end);
                
                // é‡ç½®æ–‡ä»¶é€‰æ‹©å™¨
                input.value = '';
                
                // æ›´æ–°å›¾ç‰‡åº“é¢„è§ˆ
                updateImageGallery();
                // è§¦å‘æ¸²æŸ“
                render();
            };
            reader.readAsDataURL(file);
        }

        // æ›´æ–°æœ¬åœ°å›¾ç‰‡åº“é¢„è§ˆ
        function updateImageGallery() {
            const gallery = document.getElementById('localImageGallery');
            const ids = Object.keys(bodyImageMap);
            
            if (ids.length === 0) {
                gallery.style.display = 'none';
                return;
            }
            
            gallery.style.display = 'flex';
            gallery.innerHTML = '<div style="width: 100%; font-size: 11px; color: #999; margin-bottom: 5px;">æœ¬åœ°å›¾ç‰‡é¢„è§ˆ (å¯¹åº”æ­£æ–‡ç¼–å·)ï¼š</div>';
            
            ids.forEach(id => {
                const item = document.createElement('div');
                item.style.cssText = 'display:flex; flex-direction:column; align-items:center; gap:4px;';
                item.innerHTML = `
                    <img src="${bodyImageMap[id]}" style="width:50px; height:50px; object-fit:cover; border-radius:4px; border:1px solid #DDD;">
                    <span style="font-size:10px; color:var(--primary); font-weight:bold;">${id}</span>
                `;
                gallery.appendChild(item);
            });
        }

        // é»˜è®¤æ¼”ç¤ºå›¾ç‰‡
        const defaultCoverImg = "https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=400&auto=format&fit=crop";

        const colorPresets = [
            { type: 'solid', value: '#000000' }, // çº¯é»‘è‰²
            { type: 'solid', value: '#2c3e50' },
            { type: 'solid', value: '#5D4037' },
            { type: 'solid', value: '#1E8449' },
            { type: 'solid', value: '#8E44AD' },
            { type: 'solid', value: '#a998e2' },
            { type: 'solid', value: '#d99fe9' },
            { type: 'solid', value: '#bd8b70' },
            { type: 'solid', value: '#8cb2df' },
            { type: 'solid', value: '#C0392B' },
            { type: 'solid', value: '#5e90e4' }, // æŒ‡å®šé¢œè‰²
            
            // æ¸…æ–°è“ (Fresh Match)
            { type: 'gradient', value: 'linear-gradient(180deg, #2980b9 0%, #73c8a9 100%)' },
            // å›½é£çº¢ (Chinese Match)
            { type: 'gradient', value: 'linear-gradient(to right, #D31027, #8B0000)' },
            // å¢¨éŸµ (Ink)
            { type: 'gradient', value: 'linear-gradient(135deg, #232526 0%, #414345 100%)' },
            // å›½æ½®çº¢é‡‘æ¸å˜ (Chinese Red-Gold) - è°ƒæ•´ä¸ºæ›´åçº¢çš„å›½æ½®é£æ ¼
            { type: 'gradient', value: 'linear-gradient(135deg, #8B0000 0%, #A52A2A 50%, #CD5C5C 100%)' },
            
            // æµªæ¼«æ¨¡å¼ä¸“ç”¨ï¼šç²‰è‰²åˆ°æ·¡ç´«è‰²çš„æ¸å˜
            { type: 'gradient', value: 'linear-gradient(180deg, #E084A6 0%, #9FA8DA 100%)' }
        ];

        const renderer = {
            image(href, title, text) {
                // é¢„è§ˆæ—¶ä¸ä½¿ç”¨ crossoriginï¼Œç¡®ä¿ä»»ä½•å›¾åºŠéƒ½èƒ½æ˜¾ç¤º
                return `<div class="img-container"><img src="${href}" alt="${text}" referrerpolicy="no-referrer"></div>`;
            }
        };
        marked.use({ renderer });

        window.onload = function() { 
            // 1. åˆå§‹åŒ–å˜é‡å’Œæ•°æ®
            initColorPalette();
            uploadedCoverImage = defaultCoverImg;
            document.documentElement.style.setProperty('--portrait-bg', `url('${uploadedCoverImage}')`);

            // 2. é»˜è®¤å­—ä½“åˆå§‹åŒ–
            const fCover = document.getElementById('fontCoverSelect').value;
            const fHead = document.getElementById('fontHeadSelect').value;
            const fBody = document.getElementById('fontBodySelect').value;
            document.documentElement.style.setProperty('--font-cover', fCover);
            document.documentElement.style.setProperty('--font-content-head', fHead);
            document.documentElement.style.setProperty('--font-content-body', fBody);
            
            // 3. ç»‘å®šå›¾ç‰‡ä¸Šä¼ äº‹ä»¶
            document.getElementById('coverImageUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        uploadedCoverImage = event.target.result;
                        document.documentElement.style.setProperty('--portrait-bg', `url('${uploadedCoverImage}')`);
                        render();
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // 4. è§¦å‘é»˜è®¤æ ·å¼ç‚¹å‡»å’Œåˆå§‹æ¸²æŸ“
            document.querySelector('.btn-romantic').click();
            updateParams(); 
        };

        function initColorPalette() {
            const container = document.getElementById('colorPalette');
            container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨ï¼Œé¿å…é‡å¤æ·»åŠ 
            colorPresets.forEach((preset, index) => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.background = preset.value;
                swatch.onclick = () => applyTitleColor(preset);
                
                // æ·»åŠ å³é”®åˆ é™¤åŠŸèƒ½
                swatch.oncontextmenu = (e) => {
                    e.preventDefault();
                    if (confirm(`ç¡®å®šè¦åˆ é™¤"${preset.name}"å—ï¼Ÿ`)) {
                        colorPresets.splice(index, 1);
                        initColorPalette();
                    }
                };
                
                container.appendChild(swatch);
            });
        }
        
        // åˆ‡æ¢å­—ä½“è®¾ç½®çš„æ˜¾ç¤º/éšè—
        function toggleFontSettings() {
            const container = document.getElementById('fontSettingsContainer');
            const toggle = document.getElementById('fontSettingsToggle');
            if (container.style.display === 'none') {
                container.style.display = 'block';
                toggle.innerHTML = '<i class="ph ph-caret-up"></i>';
            } else {
                container.style.display = 'none';
                toggle.innerHTML = '<i class="ph ph-caret-down"></i>';
            }
        }
        
        // æ¢å¤æ­£æ–‡é»˜è®¤é¢œè‰²
        function resetContentColors(event) {
            if (event) event.stopPropagation(); // é˜²æ­¢è§¦å‘æŠ˜å 
            
            const defaults = {
                '--content-head-color': '#000000',
                '--content-text-color': '#000000',
                '--strong-color': '#FF2442'
            };
            
            for (const [prop, val] of Object.entries(defaults)) {
                document.documentElement.style.setProperty(prop, val);
            }
            
            // æ›´æ–°å…¨å±€å˜é‡
            currentStrongColor = '#FF2442';
            
            // åŒæ­¥è¾“å…¥æ¡†
            if (document.getElementById('contentHeadColor')) document.getElementById('contentHeadColor').value = '#000000';
            if (document.getElementById('contentTextColor')) document.getElementById('contentTextColor').value = '#000000';
            if (document.getElementById('contentStrongColor')) document.getElementById('contentStrongColor').value = '#FF2442';
            
            // é‡æ–°æ¸²æŸ“
            render();
        }
        
        // åˆ‡æ¢æ­£æ–‡é¢œè‰²è®¾ç½®çš„æ˜¾ç¤º/éšè—
        function toggleContentColors() {
            const container = document.getElementById('contentColorsContainer');
            const toggle = document.getElementById('contentColorsToggle');
            if (container.style.display === 'none') {
                container.style.display = 'block';
                toggle.innerHTML = '<i class="ph ph-caret-up"></i>';
                // åŒæ­¥è¾“å…¥æ¡†åˆå§‹å€¼
                document.getElementById('contentHeadColor').value = getComputedStyle(document.documentElement).getPropertyValue('--content-head-color').trim();
                document.getElementById('contentTextColor').value = getComputedStyle(document.documentElement).getPropertyValue('--content-text-color').trim();
                document.getElementById('contentStrongColor').value = getComputedStyle(document.documentElement).getPropertyValue('--strong-color').trim();
            } else {
                container.style.display = 'none';
                toggle.innerHTML = '<i class="ph ph-caret-down"></i>';
            }
        }
        
        // æ›´æ–°æ­£æ–‡æ ‡é¢˜é¢œè‰²
        function updateContentHeadColor() {
            const color = document.getElementById('contentHeadColor').value;
            document.documentElement.style.setProperty('--content-head-color', color);
            render();
        }
        
        // æ›´æ–°æ­£æ–‡å†…å®¹é¢œè‰²
        function updateContentTextColor() {
            const color = document.getElementById('contentTextColor').value;
            document.documentElement.style.setProperty('--content-text-color', color);
            render();
        }
        
        // æ›´æ–°æ­£æ–‡åŠ ç²—é¢œè‰²
        function updateContentStrongColor() {
            const color = document.getElementById('contentStrongColor').value;
            document.documentElement.style.setProperty('--strong-color', color);
            currentStrongColor = color;
            render();
        }
        
        // åˆ‡æ¢æ ·å¼æ ‡é¢˜è‰²å½©è®¾ç½®çš„æ˜¾ç¤º/éšè—
        function toggleStyleColors() {
            const container = document.getElementById('styleColorsContainer');
            const toggle = document.getElementById('styleColorsToggle');
            if (container.style.display === 'none') {
                container.style.display = 'block';
                toggle.innerHTML = '<i class="ph ph-caret-up"></i>';
                // åˆå§‹åŒ–æ ·å¼è‰²å½©é¢„åˆ¶è‰²é¢æ¿
                initStylePalettes();
            } else {
                container.style.display = 'none';
                toggle.innerHTML = '<i class="ph ph-caret-down"></i>';
            }
        }
        
        // åˆ‡æ¢æ’ç‰ˆç»†èŠ‚è®¾ç½®çš„æ˜¾ç¤º/éšè—
        function toggleLayoutSettings() {
            const container = document.getElementById('layoutSettingsContainer');
            const toggle = document.getElementById('layoutSettingsToggle');
            if (container.style.display === 'none') {
                container.style.display = 'block';
                toggle.innerHTML = '<i class="ph ph-caret-up"></i>';
            } else {
                container.style.display = 'none';
                toggle.innerHTML = '<i class="ph ph-caret-down"></i>';
            }
        }
        
        // åˆ‡æ¢å°é¢è®¾ç½®çš„æ˜¾ç¤º/éšè—
        function toggleCoverSettings() {
            const container = document.getElementById('coverSettingsContainer');
            const toggle = document.getElementById('coverSettingsToggle');
            if (container.style.display === 'none') {
                container.style.display = 'block';
                toggle.innerHTML = '<i class="ph ph-caret-up"></i>';
            } else {
                container.style.display = 'none';
                toggle.innerHTML = '<i class="ph ph-caret-down"></i>';
            }
        }
        
        // åˆå§‹åŒ–æ ·å¼è‰²å½©é¢„åˆ¶è‰²é¢æ¿
        function initStylePalettes() {
            const styleIds = ['aurora', 'fresh', 'romantic', 'chinese'];
            styleIds.forEach(styleId => {
                const paletteContainer = document.getElementById(`${styleId}Palette`);
                if (!paletteContainer.hasChildNodes()) {
                    // æ¸…ç©ºå®¹å™¨
                    paletteContainer.innerHTML = '';
                    
                    // éå†æ‰€æœ‰é¢„åˆ¶è‰²ï¼Œåˆ›å»ºé¢œè‰²æ ·æœ¬
                    colorPresets.forEach((preset, index) => {
                        const colorSample = document.createElement('div');
                        colorSample.className = 'color-sample';
                        colorSample.style.cssText = `
                            width: 20px;
                            height: 20px;
                            border-radius: 4px;
                            background-color: ${preset.value};
                            cursor: pointer;
                            border: 1px solid #ddd;
                        `;
                        colorSample.title = preset.name;
                        
                        // ç‚¹å‡»äº‹ä»¶ï¼šå°†é¢œè‰²åº”ç”¨åˆ°å¯¹åº”æ ·å¼çš„é¢œè‰²é€‰æ‹©å™¨
                        colorSample.addEventListener('click', () => {
                            const colorPicker = document.getElementById(`${styleId}TitleColor`);
                            colorPicker.value = preset.value;
                        });
                        
                        paletteContainer.appendChild(colorSample);
                    });
                }
            });
        }
        
        // æ·»åŠ æ–°çš„é¢„åˆ¶è‰² - ç›´æ¥ä½¿ç”¨å½“å‰é¢œè‰²é€‰æ‹©å™¨çš„é¢œè‰²ï¼Œä¸éœ€è¦è®¾ç½®åå­—
        function addColorPreset() {
            const colorPicker = document.getElementById('titleColorPicker');
            const color = colorPicker.value;
            
            // ç›´æ¥æ·»åŠ é¢œè‰²ï¼Œä½¿ç”¨é¢œè‰²å€¼ä½œä¸ºåç§°
            colorPresets.push({
                name: color,
                type: 'solid',
                value: color
            });
            initColorPalette();
        }

        function togglePalette() {
            const p = document.getElementById('paletteContainer');
            if (p.style.display === 'flex') p.style.display = 'none';
            else p.style.display = 'flex';
        }

        function applyTitleColor(preset) {
            const root = document.documentElement.style;
            if (preset.type === 'solid') {
                root.setProperty('--title-color', preset.value);
                root.setProperty('--title-gradient', 'none');
                root.setProperty('--title-clip', 'border-box');
                root.setProperty('--title-text-fill', 'currentColor');
            } else {
                root.setProperty('--title-gradient', preset.value);
                root.setProperty('--title-clip', 'text');
                root.setProperty('--title-text-fill', 'transparent');
            }
            // é‡æ–°æ¸²æŸ“ä»¥ç¡®ä¿æ ·å¼ç”Ÿæ•ˆ
            render();
        }

        function updateTitleColor(type) {
            const root = document.documentElement.style;
            if (type === 'solid') {
                const color = document.getElementById('titleColorPicker').value;
                root.setProperty('--title-color', color);
                root.setProperty('--title-gradient', 'none');
                root.setProperty('--title-clip', 'border-box');
                root.setProperty('--title-text-fill', 'currentColor');
            } else {
                // é‡ç½®ä¸ºé»˜è®¤ä¸»é¢˜æ ·å¼
                root.setProperty('--title-color', '#000');
                root.setProperty('--title-gradient', 'none');
                root.setProperty('--title-clip', 'border-box');
                root.setProperty('--title-text-fill', 'currentColor');
            }
            // é‡æ–°æ¸²æŸ“ä»¥ç¡®ä¿æ ·å¼ç”Ÿæ•ˆ
            render();
        }

        function removeCoverImage() {
            uploadedCoverImage = null;
            document.getElementById('coverImageUpload').value = '';
            document.documentElement.style.setProperty('--portrait-bg', 'none');
            render();
        }

        // --- æ ¸å¿ƒæ ·å¼åˆ‡æ¢å‡½æ•° ---        
        function setStyle(style, color, btn) {
            currentStyle = style;
            currentStrongColor = color;
            document.documentElement.style.setProperty('--strong-color', color);
            document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // æ ¹æ®ä¸åŒæ¨¡å¼è®¾ç½®æ­£ç¡®çš„é»˜è®¤æ ‡é¢˜æ ·å¼
            if (style === 'style-romantic') {
                applyTitleColor(colorPresets[colorPresets.length - 1]);
            } else if (style === 'style-fresh') {
                // æ¸…æ–°æ¨¡å¼ï¼šä½¿ç”¨é¢„åˆ¶è‰²11ï¼ˆç´¢å¼•10ï¼‰
                applyTitleColor(colorPresets[10]);
            } else if (style === 'style-chinese') {
                // å›½æ½®æ¨¡å¼ï¼šä½¿ç”¨é¢„åˆ¶è‰²8ï¼ˆç´¢å¼•7ï¼‰
                applyTitleColor(colorPresets[7]);
            } else if (style === 'style-aurora') {
                // æå…‰æ¨¡å¼ï¼šä½¿ç”¨æœ€åä¸€ä¸ªé¢„åˆ¶è‰²
                applyTitleColor(colorPresets[colorPresets.length - 1]);
            } else {
                // å…¶ä»–æ¨¡å¼ï¼šé‡ç½®CSSå˜é‡
                const root = document.documentElement.style;
                root.removeProperty('--title-gradient');
                root.removeProperty('--title-clip');
                root.removeProperty('--title-text-fill');
                root.removeProperty('--title-color');
            }
            
            render();
        }

        function setAlign(align) {
            const root = document.documentElement.style;
            let alignItems = 'center';
            let textAlign = 'center';
            if (align === 'left') { alignItems = 'flex-start'; textAlign = 'left'; }
            if (align === 'right') { alignItems = 'flex-end'; textAlign = 'right'; }
            root.setProperty('--cover-align-items', alignItems);
            root.setProperty('--cover-text-align', textAlign);
            
            document.querySelectorAll('.align-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        function updateParams() {
            const cz = document.getElementById('cardZoom').value;
            const cv = document.getElementById('coverScale').value;
            const ct = document.getElementById('contentScale').value;
            const bs = document.getElementById('bodySize').value;
            const ds = document.getElementById('density').value;
            const ratio = document.getElementById('imgRatioSelect').value;

            // è®¾ç½®ç¼©æ”¾ CSS å˜é‡ï¼Œè§£å†³é‡åˆ bug
            document.documentElement.style.setProperty('--card-scale', cz);

            document.documentElement.style.setProperty('--cover-scale', cv);
            document.documentElement.style.setProperty('--content-scale', ct);
            document.documentElement.style.setProperty('--body-size', bs + 'px');
            document.documentElement.style.setProperty('--img-aspect', ratio);
            
            if (ratio === 'auto') {
                 document.documentElement.style.setProperty('--img-fit', 'contain');
            } else {
                 document.documentElement.style.setProperty('--img-fit', 'cover');
            }
            
            document.getElementById('czVal').innerText = Math.round(cz * 100) + '%';
            document.getElementById('cvVal').innerText = cv;
            document.getElementById('ctVal').innerText = ct;
            document.getElementById('bsVal').innerText = bs;
            document.getElementById('dsVal').innerText = ds;

            render();
        }

        // [ä¿®æ”¹] æ™ºèƒ½åˆ†é¡µå‡½æ•°ï¼šé‡åˆ°å›¾ç‰‡è‡ªåŠ¨æ¢é¡µï¼Œé˜²æ­¢åˆ‡å‰²
        function smartSplit(text, threshold) {
            const rawLines = text.split('\n');
            const chunks = [];
            let currentChunkLines = [];
            let currentHeight = 0;
            
            // ç¨å¾®è°ƒä½å®‰å…¨é«˜åº¦ï¼Œç»™é¡µè„šç•™ç©ºé—´
            const SAFE_MAX_HEIGHT = 440;
            const CAPACITY_FACTOR = threshold / 200.0;
            const MAX_LOAD = SAFE_MAX_HEIGHT * CAPACITY_FACTOR;

            rawLines.forEach(line => {
                let lineHeight = 30;
                const trimLine = line.trim();

                // 1. ä¼°ç®—æ–‡å­—é«˜åº¦
                if (trimLine.startsWith('# ')) lineHeight = 60;
                else if (trimLine.startsWith('## ')) lineHeight = 50;
                else if (trimLine.startsWith('### ')) lineHeight = 40;
                
                // 2. [å…³é”®] å¢å¼ºå¯¹å›¾ç‰‡çš„æ£€æµ‹
                else if (trimLine.startsWith('![')) {
                    lineHeight = 280; // [ä¿®æ”¹] é™ä½å›¾ç‰‡é¢„ç•™é«˜åº¦ï¼Œè®©çŸ­å†…å®¹å¯ä»¥å’Œå›¾ç‰‡å…±å­˜
                    
                    // [ä¼˜åŒ–] æ™ºèƒ½å›¾ç‰‡åˆ†é¡µï¼šåªæœ‰å½“å½“å‰é¡µå‰©ä½™ç©ºé—´ä¸è¶³ä»¥å®¹çº³å›¾ç‰‡æ—¶æ‰æ¢é¡µ
                    // ç¡®ä¿çŸ­å†…å®¹é¡µå¯ä»¥å’Œå›¾ç‰‡å…±å­˜ï¼Œé•¿å†…å®¹é¡µæ‰è‡ªåŠ¨æ¢é¡µ
                }
                else if (trimLine === '') lineHeight = 15;

                // 3. ä¼°ç®—æ™®é€šæ®µè½é«˜åº¦
                const charCount = line.length;
                if (charCount > 22 && !trimLine.startsWith('![')) {
                    lineHeight += Math.floor(charCount / 22) * 30;
                }

                // 4. åˆ¤æ–­æ˜¯å¦éœ€è¦æ¢é¡µ
                if (currentHeight + lineHeight > MAX_LOAD && currentChunkLines.length > 0) {
                    chunks.push(currentChunkLines.join('\n'));
                    currentChunkLines = [];
                    currentHeight = 0;
                }
                
                currentChunkLines.push(line);
                currentHeight += lineHeight;
            });

            if (currentChunkLines.length > 0) chunks.push(currentChunkLines.join('\n'));
            return chunks;
        }

        function formatText(text) { return text.replace(/\n/g, '<br/>'); }
        function getSvg(id) { return document.getElementById(id).outerHTML; }

        function render() {
            const mainTitle = document.getElementById('mainTitle').value;
            const subTitle = document.getElementById('subTitle').value;
            let bodyText = document.getElementById('bodyText').value;
            const footer = document.getElementById('footerText').value;
            const showIssue = document.getElementById('showIssue').checked;
            const issueText = document.getElementById('issueText').value;
            const coverRightText = document.getElementById('coverFooterRight').value;
            const imgPos = document.getElementById('imgPosSelect').value;
            
            const fCover = document.getElementById('fontCoverSelect').value;
            const fHead = document.getElementById('fontHeadSelect').value;
            const fBody = document.getElementById('fontBodySelect').value;

            const root = document.documentElement.style;
            root.setProperty('--font-cover', fCover);
            root.setProperty('--font-content-head', fHead);
            root.setProperty('--font-content-body', fBody);

            // åœ¨æ¸²æŸ“å‰ï¼Œå°†æ­£æ–‡ä¸­çš„æœ¬åœ°å›¾ç‰‡å ä½ç¬¦(IMG_1, IMG_2...)æ›¿æ¢ä¸ºçœŸå®çš„ Base64 æ•°æ®
            Object.keys(bodyImageMap).forEach(imgId => {
                const base64 = bodyImageMap[imgId];
                const regex = new RegExp(`\\(${imgId}\\)`, 'g');
                bodyText = bodyText.replace(regex, `(${base64})`);
            });

            const container = document.getElementById('previewArea');
            container.innerHTML = '';

            const chunks = bodyText ? smartSplit(bodyText, parseInt(document.getElementById('density').value)) : [];
            const totalPages = chunks.length;

            // --- Cover Logic ---
            const cardContainer = document.createElement('div');
            cardContainer.className = 'card-container';
            const coverWrapper = document.createElement('div');
            coverWrapper.className = `card-wrapper ${currentStyle}`;
            
            const issueHtml = showIssue ? `<div class="issue-tag">${issueText}</div>` : '';
            
            const badge = currentStyle === 'style-aurora' || currentStyle === 'style-romantic'
                ? `<div class="aurora-badge">${getSvg('icon-diamond')} ${coverRightText}</div>` 
                : `<span>${coverRightText}</span>`;

            let illustrationHtml = '';
            if (uploadedCoverImage && currentStyle !== 'style-portrait') {
                // é¢„è§ˆæ—¶ä¸ä½¿ç”¨ crossoriginï¼Œç¡®ä¿ä»»ä½•å›¾åºŠæˆ–æœ¬åœ°base64éƒ½èƒ½æ˜¾ç¤º
                illustrationHtml = `<img src="${uploadedCoverImage}" class="cover-image-inset" alt="Cover Illustration" referrerpolicy="no-referrer">`;
            }

            let centerContent = '';
            const titleHtml = `<div class="cover-title default-gradient">${formatText(mainTitle)}</div>`;
            const subHtml = `<div class="cover-sub">${formatText(subTitle)}</div>`;
            
            if (imgPos === 'top') {
                centerContent = illustrationHtml + titleHtml + subHtml;
            } else {
                centerContent = titleHtml + subHtml + illustrationHtml;
            }

            // æ£€æŸ¥æ˜¯å¦æœ‰å°é¢å›¾ç‰‡
            const hasCoverImage = uploadedCoverImage && currentStyle !== 'style-portrait';
            // è°ƒæ•´å›¾ç‰‡åœ¨æ–‡å­—ä¸‹æ–¹æ—¶çš„å°é¢æ’ç‰ˆ
            let centerClass = hasCoverImage ? 'cover-center has-image' : 'cover-center';
            if (hasCoverImage && imgPos === 'bottom') {
                centerClass += ' bottom-image';
            }
            
            if (currentStyle === 'style-portrait' && uploadedCoverImage) {
                coverWrapper.innerHTML = `
                <div class="inner-card is-cover" style="background-image: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 50%, rgba(0,0,0,0.1) 100%), url('${uploadedCoverImage}'); background-size: cover; background-position: center;">
                    <div class="cover-layout">
                        <div></div>
                        <div class="cover-center">
                            <div class="cover-title">${formatText(mainTitle)}</div>
                            <div class="cover-sub">${formatText(subTitle)}</div>
                        </div>
                    </div>
                </div>`;
            } else {
                let extraHtml = '';
                if (currentStyle === 'style-matcha') {
                    extraHtml = '<div class="deco-circle" style="width:150px;height:150px;top:-30px;right:-30px;"></div><div class="deco-circle" style="width:100px;height:100px;bottom:20px;left:-20px;"></div>';
                }
                
                if (currentStyle === 'style-chinese') {
                    extraHtml = ''; 
                }

                coverWrapper.innerHTML = `
                <div class="inner-card is-cover">
                    ${extraHtml}
                    <div class="cover-layout">
                        <div style="width:100%">${issueHtml}</div>
                        <div class="${centerClass}">
                            ${centerContent}
                        </div>
                        <div class="cover-footer">
                            <span class="footer-left">${footer}</span>
                            ${badge}
                        </div>
                    </div>
                </div>`;
            }
            cardContainer.appendChild(coverWrapper);
            container.appendChild(cardContainer);

            // --- Content ---
            chunks.forEach((chunk, i) => {
                const contentContainer = document.createElement('div');
                contentContainer.className = 'card-container';
                const cardWrapper = document.createElement('div');
                cardWrapper.className = `card-wrapper ${currentStyle}`;
                
                if (currentStyle === 'style-portrait' && uploadedCoverImage) {
                    cardWrapper.style.backgroundImage = `url('${uploadedCoverImage}')`;
                    cardWrapper.style.backgroundRepeat = 'no-repeat';
                    cardWrapper.style.backgroundSize = 'cover';
                    cardWrapper.style.backgroundPosition = 'center';
                    
                    cardWrapper.style.backdropFilter = 'blur(20px)';
                }

                const html = marked.parse(chunk);
                const pageNum = `<span>${i+1} / ${totalPages}</span>`;
                
                let novelHeader = '';
                if (currentStyle === 'style-novel') {
                    novelHeader = `<div class="novel-header"><span>${mainTitle.split('\n')[0]}</span><span>${pageNum}</span></div>`;
                }

                let contentHtml = `
                    <div class="inner-card">
                        ${novelHeader}
                        <div class="content-body">
                            <div class="markdown-content">${html}</div>
                        </div>
                        <div class="content-footer">
                            <span class="footer-left">${footer}</span>
                            ${currentStyle !== 'style-novel' ? pageNum : ''}
                        </div>
                    </div>`;
                
                cardWrapper.innerHTML = contentHtml;
                contentContainer.appendChild(cardWrapper);
                container.appendChild(contentContainer);
            });
        }

        // [æœ€ç»ˆä¿®å¤ç‰ˆ] ä¸‹è½½å‡½æ•°ï¼šé˜²ç¼“å­˜ + é˜²è·¨åŸŸ + é˜²æ ‡é¢˜é»‘å—
        async function downloadAll() {
            // 1. ç¡®ä¿é¡µé¢ä¸Šçš„å›¾ç‰‡éƒ½åŠ è½½å®Œäº†å†æˆªå›¾
            const waitForImages = () => {
                return new Promise((resolve) => {
                    const images = document.querySelectorAll('img');
                    if (images.length === 0) return resolve();
                    let loaded = 0;
                    images.forEach(img => {
                        if (img.complete) {
                            loaded++;
                            if (loaded === images.length) resolve();
                        } else {
                            img.onload = () => { loaded++; if(loaded === images.length) resolve(); };
                            img.onerror = () => { loaded++; if(loaded === images.length) resolve(); };
                        }
                    });
                });
            };
            await waitForImages();
            
            const wrappers = document.querySelectorAll('.card-wrapper');
            const btn = document.getElementById('dlBtn');
            const oldText = btn.innerText;
            btn.innerText = 'ç”Ÿæˆä¸­...'; btn.disabled = true;
            
            let zipName = "RedNote_Cards";
            const titleVal = document.getElementById('mainTitle').value.trim();
            if(titleVal) zipName = titleVal.replace(/[\\/:*?"<>|\n]/g, "_").substring(0, 30);

            let count = 0;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            let zip = isMobile ? null : new JSZip();
            let imgFolder = isMobile ? null : zip.folder("images");

            for (let i = 0; i < wrappers.length; i++) {
                const bg = (currentStyle === 'style-simple') ? '#fff' : null;
                try {
                    const canvas = await html2canvas(wrappers[i], {
                        scale: 2,
                        useCORS: true, // å¿…é¡»å¼€å¯è·¨åŸŸ
                        allowTaint: false, // [å…³é”®ä¿®æ”¹] å¿…é¡»è®¾ä¸ºfalseï¼Œå¦åˆ™ tainted ç”»å¸ƒæ— æ³•å¯¼å‡º
                        backgroundColor: bg,
                        logging: false,
                        
                        onclone: (clonedDoc) => {
                            // A. [æ ¸å¿ƒä¿®å¤] ç»™å›¾ç‰‡åŠ æ—¶é—´æˆ³ï¼Œå¼ºåˆ¶æµè§ˆå™¨ä¸è¯»ç¼“å­˜ï¼Œé‡æ–°ä»è…¾è®¯äº‘è·å–å¸¦CORSå¤´çš„å›¾ç‰‡
                            const images = clonedDoc.querySelectorAll('img');
                            images.forEach(img => {
                                img.crossOrigin = 'anonymous';
                                
                                // å¦‚æœæ˜¯ç½‘ç»œå›¾ç‰‡ï¼ˆä¸æ˜¯base64ï¼‰ï¼ŒåŠ ä¸ªéšæœºæ•°å°¾å·´
                                if (img.src && img.src.startsWith('http')) {
                                    // æ‹¼æ¥éšæœºå‚æ•° ?t=123456...
                                    const separator = img.src.includes('?') ? '&' : '?';
                                    img.src = img.src + separator + 't=' + new Date().getTime();
                                }
                            });
                            
                            // B. ä¿®å¤æ ‡é¢˜æ¸å˜è‰²å¯¼å‡ºé—®é¢˜
                            const coverTitles = clonedDoc.querySelectorAll('.cover-title');
                            const rootStyles = document.documentElement.style;
                            const isGradient = rootStyles.getPropertyValue('--title-gradient') !== 'none';
                            
                            coverTitles.forEach(title => {
                                if (isGradient) {
                                    let exportColor = currentStrongColor;
                                    if(currentStyle === 'style-fresh') exportColor = document.getElementById('freshTitleColor').value;
                                    if(currentStyle === 'style-romantic') exportColor = document.getElementById('romanticTitleColor').value;
                                    if(currentStyle === 'style-aurora') exportColor = document.getElementById('auroraTitleColor').value;
                                    if(currentStyle === 'style-chinese') exportColor = document.getElementById('chineseTitleColor').value;
                                    
                                    title.style.cssText = `
                                        background-image: none !important;
                                        -webkit-text-fill-color: initial !important;
                                        color: ${exportColor} !important;
                                        display: inline-block;
                                        white-space: pre-wrap;
                                        width: 100%;
                                    `;
                                }
                            });
                        }
                    });
                    
                    const dataUrl = canvas.toDataURL('image/png');
                    
                    if (isMobile) {
                        const link = document.createElement('a');
                        link.download = `${zipName}_${i}.png`;
                        link.href = dataUrl;
                        link.click();
                    } else {
                        const base64 = dataUrl.split(',')[1];
                        imgFolder.file(`${zipName}_${i===0?'Cover':'Page_'+i}.png`, base64, {base64: true});
                    }
                    count++;
                } catch(e) { console.error(e); }
            }
            
            if (!isMobile && count > 0) {
                const content = await zip.generateAsync({type:"blob"});
                saveAs(content, `${zipName}.zip`);
            }
            
            if (count === 0) alert("ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥å›¾ç‰‡è·¨åŸŸé…ç½®");
            btn.innerText = oldText; btn.disabled = false;
        }
    </script>
</body>
</html>